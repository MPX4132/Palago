<!DOCTYPE html>
<html>
<head>

<style>
	body {
		padding: 36px 44.75px;
		margin:0px;
		font-size:0px; /* The Hell? */
		overflow: scroll;
		white-space: nowrap; /* To prevent wrapping of inline-block */
		
		font-family: arial, "Century Gothic";
		
		color: #333;
		text-shadow: 0px -1px 0px white;
	}
	
	a {
		color: inherit;
		text-decoration: none;
	}
	
	a:hover {
		color: #FFF;
		text-shadow: 0px 1px 0px black;
	}
	
	body > div#board > ul {
		display: inline-block;
		position: relative;
		list-style-type: none;
		padding: 0px;
	
		margin-left: -8.75px;
		margin-right: -8.75px;
	}
	
	body > div#board > ul.offset {
		top: 62px;
		/*left: -36px;*/
	}
	
	body > div#board > ul > li {
		width: 142px;
		height: 123px;
		padding: 0;
		/*padding-top: 1.8em;*/
		margin: inherit;
		background-image: url('unused-piece.png');
		background-position: center center;
		background-repeat: no-repeat;
		
		font-size: 18px;
		text-align: center;
	}
	
	body > div#board > ul > li.used {
		background-image: url('piece.png');
	}
	
	body > div#board > ul > li > * {
		position: absolute;
		width: 100%;
		padding-top: 1em;
		padding-left: 8.75px;
		padding-right: 8.75px;
		text-align: center;
	}
</style>

<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

<script>
	
	
	$(function() {
		let $controls = $($("#t-controls").html());
		
		function $MakeItem() {
			var $item = $("<li>").click(function() {
				if ($(this).hasClass("used")) return;
				
				$(this).addClass("used").append($controls);
				$controls.show();
			})
			return $item;
		}
		
		$controls.find("a.rotation").click(function() {
			let $parent = $(this).closest("li");
			let currentRotation = $parent.data("rotation") || 0;
			let offsetRotation = ($(this).html() == "&gt;")? 60 : -60;
			let rotation = currentRotation + offsetRotation;
			$parent.css("transform", "rotate(" + rotation + "deg)");
			$parent.data("rotation", rotation);
		})
		
		$controls.find("a.commit").click(function() {
			let $target = $(this).closest("li");
			let $parent = $target.parent();
			
			if ($("body > div#board > ul:first-child").is($parent)) {
				var $list = $("<ul>");
				if (!$parent.hasClass("offset")) $list.addClass("offset");
				$parent.children().each(function(i) {
					$list.append($MakeItem());
				})
				$("body > div#board").prepend($list);
			}
			if ($("body > div#board > ul:last-child").is($parent)) {
				var $list = $("<ul>");
				if (!$parent.hasClass("offset")) $list.addClass("offset");
				$parent.children().each(function(i) {
					$list.append($MakeItem());
				})
				$("body > div#board").append($list);
			}
			if ($($parent.children().first()).is($target)) {
				$("body > div#board > ul").each(function(i) {
					$(this).prepend($MakeItem());
				});
			}
			if ($($parent.children().last()).is($target)) {
				$("body > div#board > ul").each(function(i) {
					$(this).append($MakeItem());
				});
			}
			
			$controls.hide();
		})
		
		/*$("body").click(function(event) {
			let target = event.target;
			let $target = $(target);
			let $parent = $target.parent();
			
			if ($target.is("li") && !$target.hasClass("used")) {
				if ($("body > ul:first-child").is($parent)) {
					var $list = $("<ul>");
					if (!$parent.hasClass("offset")) $list.addClass("offset");
					$parent.children().each(function(i) {
						$list.append($MakeItem());
					})
					$("body").prepend($list);
				}
				if ($("body > ul:last-child").is($parent)) {
					var $list = $("<ul>");
					if (!$parent.hasClass("offset")) $list.addClass("offset");
					$parent.children().each(function(i) {
						$list.append($MakeItem());
					})
					$("body").append($list);
				}
				if ($($parent.children().first()).is($target)) {
					$("body>ul").each(function(i) {
						$(this).prepend($MakeItem());
					});
				}
				if ($($parent.children().last()).is($target)) {
					$("body>ul").each(function(i) {
						$(this).append($MakeItem());
					});
				}
			}
		})*/
		
		var $StartList = $("<ul>").append($MakeItem());
		$("body > div#board").append($StartList);
	});
	
</script>

</head>
	<body><!--this is a comment-->
		<template id="t-controls">
			<div>
				<p><a href="#" class="rotation">&lt;</a> ROTATE <a href="#" class="rotation">&gt;</a></p>
				<p><a href="#" class="commit">[PLACE]</a></p>
			</div>
		</template>
		<div id="board"></div>
	</body>
</html>
